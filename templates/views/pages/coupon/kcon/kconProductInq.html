<!-- extend base layout -->
{% extends "views/master.html" %}

{% block body %}
<div class="right_col" role="main">
    <div class="">
        <div class="page-title">
            <div class="title_left">
                <h3>KCON 상품 등록 조회</h3>
                <h5><span class="red">[홈 > 쿠폰 관리 > KCON 상품 등록 조회]</span></h5>
            </div>

        </div>

        <div class="clearfix"></div>

        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_content form">
                        <form action="#" id="searchForm" class="form-bordered ">
                            <input type="hidden" id="submerchantId" name="submerchantId" >                              
                            <input type="hidden" id="serviceId" name="serviceId" >                              
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <div class="col-md-12 col-sm-12 col-xs-12 form-group ">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">- 검색 조건 </label>
                                </div>
                            </div>
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-left form-border-right ">
                                    <label class="control-label col-lg-3 col-md-12 col-sm-3 col-xs-12">상품 ID</label>
                                    <div class="col-lg-9 col-md-12 col-sm-9 col-xs-12 form-inline">
                                    	<input type="text" id="id" name="id" class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-right form-border-left-xs">
                                    <label class="control-label col-lg-3 col-md-12 col-sm-12 col-xs-12">상품명</label>
                                    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12 form-inline">
                                    	<input type="text" id="name" name="name" class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-left form-border-right ">
                                    <label class="control-label col-lg-3 col-md-12 col-sm-12 col-xs-12">상품유형</label>
                                    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12 form-inline">
	                                    <select class="form-control" id="type" name="type" >
	                                    	<option value="">전체</option>
	                                    </select>
	                            </div>
                                </div>
                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-right form-border-left-xs">
                                    <label class="control-label col-lg-3 col-md-12 col-sm-12 col-xs-12">상품유형상세</label>
                                    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12 form-inline">
	                                    <select class="form-control" id="typeDetail" name="typeDetail" >
	                                    	<option value="">전체</option>
	                                    </select>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-left form-border-right ">
                                    <label class="control-label col-lg-3 col-md-12 col-sm-3 col-xs-12">권종</label>
                                    <div class="col-lg-9 col-md-12 col-sm-9 col-xs-12 form-inline">
                                    	<input type="text" id="amount" name="amount" class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-right form-border-left-xs">
                                    <label class="control-label col-lg-3 col-md-12 col-sm-12 col-xs-12">상품상태</label>
                                    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12 form-inline">
	                                    <select class="form-control" id="status" name="status" >
	                                    	<option value="">전체</option>
	                                    </select>
                                    </div>
                                </div>                                    
                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-left form-border-right ">
                                    <label class="label-top-3 custom-col-lg-2 col-md-2 col-sm-3 col-xs-12">
	                                   <select class="select2_single select2-selection--single " id="dateType" name="dateType" >
	                                       <option value="1">등록기간</option>
	                                   </select>
                                    </label>
                                    <div class="custom-col-lg-8 col-md-12 col-sm-9 col-xs-12 form-inline">
                                    	<input type="text" class="form-control input-date-picker-long" id="startDate" name="startDate" >
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-right form-border-left-xs">
                                    <label class="control-label col-lg-3 col-md-12 col-sm-12 col-xs-12">등록자</label>
                                    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12 form-inline">
										<input type="text" id="register" name="register" class="form-control col-md-7 col-xs-12" maxlength="12" readonly="readonly" >
										<span class="input-group-btn">
                                        	<button class="btn btn-default btn-search userSearch" type="button">조회</button>
                                        </span>                                    
                                    </div>
                                </div>                                    
                            </div>                            
                        </form>
                        <br />
                        <div class="column-align-right">
							<!-- <a id="history" class="dt-button btn green btn-outline" href="javascript:;"><span>History</span></a> -->
							{% if admin_view.pageAuth["updFlag"] == "1" %}                        
							<button type="button" id="cancel" class="dt-button btn green btn-outline" style="display:none;"><span>발행중지</span></button>
 							<button type="button" id="kconProductUpdateBtn" class="dt-button btn green btn-outline"><span>수정</span></button>
							{% endif %}  					
							{% if admin_view.pageAuth["delFlag"] == "1" %}                        	
							<button type="button" id="deleteBtn" class="dt-button btn red btn-outline"><span>삭제</span></button>
							<button type="button" id="deleteApprovalRequestBtn" class="dt-button btn red btn-outline hidden"><span>삭제</span></button>
							{% endif %}
							<button type="button" id="clear" class="dt-button btn red btn-outline"><span>초기화</span></button>
	                        <br />
						</div>
						<br />
						<form action="#" id="detailForm" class="form-bordered ">
		                	<div class="col-md-12 col-sm-12 col-xs-12">
			                    <div class="col-md-12 col-sm-12 col-xs-12 form-group ">
			                    </div>
		                 	</div>	                        
			                <div class="col-md-12 col-sm-12 col-xs-12">
			                    <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-left form-border-right">
			                        <label class="control-label col-lg-3 col-md-12 col-sm-3 col-xs-12" >상품 ID</label>
			                        <div class="col-lg-9 col-md-12 col-sm-9 col-xs-12 span-vertical-middle">
										<span id="productId" class="form-border-left-lg col-md-7 col-xs-12 span-vertical-middle" ></span>
			                        </div>
			                    </div>
			                    <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-right form-border-left-xs">
			                        <label class="control-label col-lg-3 col-md-12 col-sm-3 col-xs-12" >상품명</label>
			                        <div class="col-lg-9 col-md-12 col-sm-9 col-xs-12 span-vertical-middle">
										<span id="title" class="form-border-left-lg col-md-7 col-xs-12 span-vertical-middle"></span>
			                        </div>
			                    </div>
			                </div>
			                <div class="col-md-12 col-sm-12 col-xs-12">
			                    <div class="col-md-12 col-sm-12 col-xs-12 form-group ">
			                        <label class="control-label col-md-3 col-sm-3 col-xs-12" ><b>[쿠폰 상품 속성]</b></label>
			                    </div>
			                </div>	                        
			              	<div class="col-md-12 col-sm-12 col-xs-12">
								<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-left form-border-right ">
								    <label class="control-label col-lg-3 col-md-12 col-sm-12 col-xs-12">상품유형</label>
								    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12 span-vertical-middle">
										<span id="typeName" class="form-border-left-lg col-md-7 col-xs-12 span-vertical-middle"></span>
								    </div>
								</div>
								<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-right form-border-left-xs">
								    <label class="control-label col-lg-3 col-md-12 col-sm-12 col-xs-12">상품유형상세</label>
								    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12 span-vertical-middle">
										<span id="typeDetailName" class="form-border-left-lg col-md-7 col-xs-12 span-vertical-middle"></span>
								    </div>
								</div>	                                
								<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-left form-border-right ">
								    <label class="control-label col-lg-3 col-md-12 col-sm-12 col-xs-12">권종</label>
								    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12 span-vertical-middle">
										<span id="amountWithCommas" class="form-border-left-lg col-md-7 col-xs-12 span-vertical-middle"></span>
								    </div>
								</div>
								<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-right form-border-left-xs">
								    <label class="control-label col-lg-3 col-md-12 col-sm-12 col-xs-12">유효기간 설정</label>
								    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12 span-vertical-middle">
										<span id="expireDaysTypeName" class="form-border-left-lg col-md-7 col-xs-12 span-vertical-middle"></span>
								    </div>
								</div>
								<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 form-group form-border-left form-border-right ">
								    <label class="control-label col-lg-3 col-md-12 col-sm-12 col-xs-12">상품등록자</label>
								    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12 span-vertical-middle">
										<span id="register" class="form-border-left-lg col-md-7 col-xs-12 span-vertical-middle"></span>
								    </div>
								</div>	                                
							</div>
						</form>
                        <br />
                        <table id="kconProductTable" class=" table table-striped table-bordered" style="width: 100%">
                            <thead>
                                <tr>
                                    <th>순번</th>
                                    <th>상품ID</th>
                                    <th>상품상태</th>
                                    <th>폐기여부</th>
                                    <th>상품유형</th>
                                    <th>상품유형상세</th>
                                    <th>권종</th>
                                    <th>상품명</th>
                                    <th>유효기간</th>
                                    <th>등록자</th>
                                    <th>등록일</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- modal include -->
{% include 'views/pages/common/approval/popup/approval-request-delete-modal.html' %}

{% endblock %}

{% block tail %}
    <!-- datatable lib-->
    <script src="/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="/bower_components/datatables.net-bs/js/dataTables.bootstrap.js"></script>
    <script src="/bower_components/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="/bower_components/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <script src="/bower_components/datatables.net-buttons/js/buttons.flash.min.js"></script>
    <script src="/bower_components/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="/bower_components/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="/bower_components/jszip/dist/jszip.min.js"></script>
    <script src="/bower_components/pdfmake/build/pdfmake.min.js"></script>
    <script src="/bower_components/pdfmake/build/vfs_fonts.js"></script>
    <script src="/assets/js/approval/approval.js"></script>        
    <script type="text/javascript">

        var kcon = function () {
        	var table;
        	var typeDetailCPCData = { resultList : []};
        	var typeDetailCPTData = { resultList : []};
        	var typeDetailAllData = { resultList : []};
            var setDatePicker = function (){
            	kpcUtil.setDateRangePicker('#startDate');
            }
  
            var setSelect2 = function () {
                $("#dateType").select2({
                    width: 110,
                });
            }
            
            var setCommonCode = function (){
      			kpcUtil.setSelectBoxData({
            		target : [
            			 "#type",
            			 "#status",
            		], 
            		apiUrl : "/api/systemMng/common/commonCodeList",
            		params : {type : 'PRTY,STS'},
            		type   : "GET",
            		option : {width : 110},	
            		callBack : function (data,target,option){
            			for(var idx in data){
            				for(var idx2 in data[idx].resultList){
	            				$(target[idx]).append($("<option></option>")
	            						.attr("value" , data[idx].resultList[idx2].code)
	            						.text(data[idx].resultList[idx2].codeName));
            				}
            				$(target[idx]).select2(option);       
            			}
              			kpcUtil.setSelectBoxData({
                    		target : [
                    			 "#typeDetail",
                    		], 
                    		apiUrl : "/api/systemMng/common/commonCodeList",
                    		params : {type : 'CPC,CPT'},
                    		type   : "GET",
                    		option : {width : 150},	
                    		callBack : function (data,target,option){
                    			setTypeDetailCPCData(data[0].resultList);
                    			setTypeDetailCPTData(data[1].resultList);
                    			setTypeDetailAllData(data[0].resultList);
                    			setTypeDetailAllData(data[1].resultList);
                    			settypeDetail(typeDetailAllData);
		            			setDataTable();
		            			pageEvents();
                    		}
                    	});            		            			
            		}
            	});            	
            }             
            var setTypeDetailCPCData = function (data){
            	for(var idx in data){
	            	typeDetailCPCData.resultList.push(data[idx]);
            	}
            }
            var setTypeDetailCPTData = function (data){
            	for(var idx in data){
            		typeDetailCPTData.resultList.push(data[idx]);
            	}
            }
            var setTypeDetailAllData = function (data){
            	for(var idx in data){
            		typeDetailAllData.resultList.push(data[idx]);
            	}            	
            }
            var setDataTable = function () {
                table = $('#kconProductTable')
                    .on('click', '.det', function () {
                    	if($(this).attr("productId") == ""){
                    		kpcUtil.customAlert("쿠폰 상태가 폐기인 쿠폰은 수정 불가능합니다.");
                    		return false;
                    	}
                    	getBrochureData($(this).attr("productId"),"#detailForm");
                    })  
                    .dataTable(
                        {
                            "processing": true,
                            "serverSide": true,
                            "ajax": {
                                "url": "/api/coupon/brochures",
                                "contentType" : "application/x-www-form-urlencoded; charset=UTF-8",
                                "async" : "true",
                                "data": function (parameter) {
                                    parameter.formData = $("#searchForm").serializeObject();
                                },
                                "error" : function (e){kpcUtil.sessionExpire(e);}
                            },
                            "ordering": false,
                            "drawCallback": function (settings) {
                                for (var i = 0, iLen = settings.aiDisplay.length; i < iLen; i++) {
                                    $('td:eq(0)', settings.aoData[settings.aiDisplay[i]].nTr).html(i + 1 + settings._iDisplayStart);
                                    settings.json.data[i].rownum = i + 1 + settings._iDisplayStart;
                                }

                            	kpcPopupUtil.setUserTableColumnData({
                            		tableId : "kconProductTable",
                            		menuId : "{{session['menuId']}}", 
                            		targetTable : table 
                            	});
                            },
                            columns: [
                                  {data : "rownum"     , defaultContent: "",width: 60, className: "column-align-right"}, // 순번
                                  {data : "productId"         , defaultContent: "", width: 150, className: "column-align-center"},  // 상품ID               
                                  {data : "statusName"     , defaultContent: "", width: 150, className: "column-align-center"},  // 상품상태               
                                  {data : "delFlag"     , defaultContent: "", width: 150, className: "column-align-center"},  // 폐기여부               
                                  {data : "typeName"       , defaultContent: "", width: 150, className: "column-align-center"},  // 상품유형               
                                  {data : "typeDetailName"    , defaultContent: "", width: 150, className: "column-align-center"},  // 상품유형상세               
                                  {
                                    	data : "amount" , 
    	                                defaultContent: "", 
    	                                width: 100,
    	                                className: "column-align-right" ,
    	                                render : function (data, type , full , meta){
    	                                	return kpcUtil.numberWithCommas(full.amount);
    	                                }
                                  }, // 권종                                     
                                  {
                                  	data : "title" ,
  	                                defaultContent: "",
  	                                width: 150,
  	                                className: "column-align-right",
  	                                render : function (data, type , full , meta){
  	                                	var id = "";
  	                                	if(full.delFlag != "Y"){
  	                                		id = full.productId;
  	                                	}
  	                                    // 상세보기 버튼
  	                                	return '<a class="blue det" href="javascript:;" productId="' + id + '">' + full.title + '</a>';
  	                                }
                                  },  // 상품명               
                                  {
                                    	data : "createDate" ,
    	                                defaultContent: "",
    	                                width : 180,
    	                                className: "column-align-center" ,
    	                                render : function (data, type , full , meta){
    	                                	
    				                        var expireDaysType = full.expireDaysType;
    				                        var expireDaysTypeName = "";
    	                                	if(expireDaysType =='DATE-0001'){
    	                                		expireDaysTypeName = '발행일로부터 ' + full.expireDays + ' 일'  
    	                                	}else if(expireDaysType =='DATE-0002'){
    	                                		expireDaysTypeName = '발행일로부터 ' + full.expireDays + ' 개월'    	                                		
    	                                	}else if(expireDaysType =='DATE-0003'){
    	                                		expireDaysTypeName = '발행일로부터 ' + full.expireDays + ' 년'    	                                		
    	                                	}
    	                                	return expireDaysTypeName;
    	                                }
                                  },  // 유효기간                                        
                                  {data : "register", defaultContent: "", width: 100, className: "column-align-center"},  // 등록자               
                                  {
                                    	data : "createDate" ,
    	                                defaultContent: "",
    	                                width : 90,
    	                                className: "column-align-center" ,
    	                                render : function (data, type , full , meta){
    	                                	return kpcUtil.setDateFormat(full.createDate , "YYYY-MM-DD");
    	                                }
                                  },  // 등록일                                        
                            ],
                            buttons: [
                                {
                                	text: 'Layout',
                                	className: 'dt-button btn green btn-outline ',
                                	action: function (e, dt, node, config) {
                                    	kpcPopupUtil.openTableColumnMng({
    							    		columnArray : $(table).find("thead>tr>th").siblings().not(".checkboxes"),
    							    		tableId : "kconProductTable",
    							    		menuId : "{{session['menuId']}}",
    							    		targetTable : table
        								}); 
                                	}
                                },
                                {
                                    text: 'Excel',
                                    className: 'btn yellow btn-outline ',
                                    action: function (e, dt, node, config) {
                                    	if(kpcUtil.confirm("전체 자료를 Excel변환 하시겠습니까?")){
                							$.ajax({
                	                            url: "/api/coupon/brochures/excelAll",
                	                            type: 'GET',
                	                            data : $("#searchForm").serialize(),
                	                            contentType  : "application/json",
                	                            async : true,
                	                            success: function(data){
                	                            	kpcUtil.customAlert("Excel 변환 요청 성공\n작업 결과는 [시스템관리->배치 작업 조회]페이지에서 확인하세요.");
                	                            },
                	                            error : function(e){
                	                            	kpcUtil.errorHandling(e);
                	                            }
                	                       });                                      		
                                    	}                                    	
                                    }
                                },                                      
                                {
                                    text: '조회',
                                    className: 'btn green btn-outline ',
                                    action: function (e, dt, node, config) {
                                        table.fnFilter();
                                    }
                                }
                            ],
                            "lengthMenu": [[10, 20, 30, 50, 200], [10, 20, 30, 50, 200]],
                            "pageLength": 10,
                            "dom": "<'row' <'col-md-8 col-sm-12'l><'col-md-4 col-sm-12'B>><'table-scrollable'tr><'row'<'col-md-6 col-sm-6'i><'col-md-6 col-sm-6'p>>",
                            responsive: true,
                            "language": {
                                "aria": {
                                    "sortAscending": ": activate to sort column ascending",
                                    "sortDescending": ": activate to sort column descending"
                                },
                                "info":"Total Record: _TOTAL_ Page : _PAGE_ / _PAGES_ ",
                                "emptyTable": "조회된 자료가 없습니다.",
                                "infoEmpty": "조회된 자료가 없습니다.",
                                "lengthMenu": "_MENU_",
                                "zeroRecords": "조회된 자료가 없습니다."
                            },
                        }
                    );
            }
            
            var pageEvents = function (){

           		$("#searchForm #type").change(function (){
       				if($(this).val() == "PRTY-0001"){
       					settypeDetail(typeDetailCPCData);
       				}else if ($(this).val() == ""){
       					settypeDetail(typeDetailAllData);
       				}else{
       					settypeDetail(typeDetailCPTData);
       				}
           		});                	
           		
            	$(".userSearch").click(function (){
            		kpcPopupUtil.openUserSearchPop({
            			callBackFunction : function (empId){
            				$("#register").val(empId);
            				$("#register").focus();
            			}
            		});
            	});
            	$("#history").click(function (){
   			   		kpcUtil.openCommonPopup({
   			   			modalTitle : "정산 상세",
   			   			modalSize : "modal-full",
   			   			modalType : "URL",
   			   			URL : "/approval/kcon/historyPop?historyType=APPR-0501",
   			   			method : "GET",		   			
   			   		});					           			
            	});            	
            	
            	$("#cancel").click(function (){
            		var id = kpcUtil.nullToBlank($("#detailForm #productId").text());
            		console.log(id);
            		if(id === ""){
            			kpcUtil.customAlert("쿠폰 상품을 선택 하세요.");
            			return false;
            		}
            		var publishText = $(this).text();
            			
	                   	var menuId = "CPN-1001";
                    	// 승인자 선택
                    	kpcPopupUtil.openApprListPop({
                    		 menuId : menuId 
                    		,callBack : function (data){
			            		if(kpcUtil.confirm(publishText + " 승인 요청 하시겠습니까?") ){
	                    			var apprEmpId = $("input[name=empList]:checked").attr("empId");
	   			   					if(typeof apprEmpId === "undefined"){
	   			   						kpcUtil.customAlert("승인자를 선택해주세요.");
	   			   						return false;
	   			   					} else {
	   			            			var status = publishText == "발행중지" ? "01" : "02" ; // 01 = 발행중지 해제 요청 , 02 == 발행중지 요청 
	   			                        $.ajax({
	   			                            url: "/api/coupon/brochures/brochure/publishStop",
	   			                            contentType  : "application/json",
	   			                            data : JSON.stringify({"id" : id , "apprEmpId" : apprEmpId , "menuId" : menuId , "status" : status }),
	   			                            type: 'PUT',
	   			                            dataType : "json",
	   			                     	}).done(function(data,status,jqXhr){
	   				                 		if(kpcUtil.successHandlingToMsg("",data,true, publishText + " 승인 요청 되었습니다.")){
	   				                 			$("#commonPopupModal2").modal('toggle');
	   				                 			$("#clear").trigger("click");	
	   				                 		}
	   			                         }).fail(function(e){
	   			                 	    	kpcUtil.errorHandling(e);
	   			               	         });      			   						
	   			   					}
		            			}            		
                    		}
                    	});            			
            	});
            	$("#clear").click(function (){
            		kpcUtil.resetSpanForm("#detailForm");
            		$("#cancel").css("display", "none");
            	});
            	
            	$("#deleteBtn").click(function() {
            		var id = kpcUtil.nullToBlank($("#detailForm #productId").text());
            		if(id === ""){
            			kpcUtil.customAlert("쿠폰 상품을 선택 하세요.");
            			return false;
            		}
            		if($("#cancel").text() == "발행해제"){
            			kpcUtil.customAlert("발행중지 상태 입니다.\n발행해제 후 삭제 바랍니다.");
            			return false;
            		}
            		requestDeleteButtonTrigger($("#productId").text());
            	})
            	
            	{% if admin_view.pageAuth["updFlag"] == "1" %}
            	$("#kconProductUpdateBtn").click(function() {
            		var id = kpcUtil.nullToBlank($("#detailForm #productId").text());
            		if(id === ""){
            			kpcUtil.customAlert("쿠폰 상품을 선택 하세요.");
            		}
            		else {
            			
            			
                		var isExist = approval.existApprovalRequest(id);
                		if (!isExist) {
		            		location.href="/coupon/kcon/kconProduct/update?productId="+id;       	
                		}
            			
            			
            		}
           		}) 
            	{% endif %}
    			// 조회 이벤트
            	kpcUtil.serachFormEvent({
            		selects : "#searchForm select",
            		inputs : "#searchForm input",
            		callback : function (){
            			table.fnFilter();
            		}
            	});                 
            }
            
            var getBrochureData = function (id,target){
                $.ajax({
                    url: "/api/coupon/brochures/brochure",
                    data: "id=" + id,
                    type: 'GET',
                    dataType : "json",
             	}).done(function(resultData,status,jqXhr){
             		kpcUtil.setFormData(target , resultData);
             		if(target === "#detailForm"){
	             		$("#amountWithCommas").text(kpcUtil.numberWithCommas(resultData.amount));
	                    var expireDaysType = resultData.expireDaysType;
	                    var expireDaysTypeName = "";
	                   	if(expireDaysType =='DATE-0001'){
	                   		expireDaysTypeName = '발행일로부터 ' + resultData.expireDays + ' 일'  
	                   	}else if(expireDaysType =='DATE-0002'){
	                   		expireDaysTypeName = '발행일로부터 ' + resultData.expireDays + ' 개월'    	                                		
	                   	}else if(expireDaysType =='DATE-0003'){
	                   		expireDaysTypeName = '발행일로부터 ' + resultData.expireDays + ' 년'    	                                		
	                   	}
	                   	$("#expireDaysTypeName").text(expireDaysTypeName);
             		}
             		$("#cancel").css("display", "inline");
             		// 발행중지 상태
             		if(resultData.status == "02"){
             			$("#cancel").text("발행중지 해제");
             		}else{
             			$("#cancel").text("발행중지");
             		}
                 }).fail(function(e){
         	    	kpcUtil.errorHandling(e);
       	         });
                
            }
            
            
            var setUpdEvents = function (){
           		$("select[name=expireDaysType]").change(function (){
           			console.log($(this).val());
           			if($(this).val() == "DATE-0001"){
           				$("#dateTypeText").html("&nbsp;일");
           			}else if($(this).val() == "DATE-0002"){
           				$("#dateTypeText").html("&nbsp;개월");
           			}else if($(this).val() == "DATE-0003"){
           				$("#dateTypeText").html("&nbsp;년");
           			}
           		});            	
            }
            
            var settypeDetail = function (data , target){
            	$("#searchForm #typeDetail").html('');
				$("#searchForm #typeDetail").append($("<option></option>")
						.attr("value" , "")
						.text("전체"));
				for(var idx in data.resultList){
    				$("#searchForm #typeDetail").append($("<option></option>")
    						.attr("value" , data.resultList[idx].code)
    						.text(data.resultList[idx].codeName));
				}
				$("#searchForm #typeDetail").select2({width : 120});                   	
            }            
            
            var settypeUpdDetail= function (data , target){
            	$("#couponUpdForm #typeDetail").html('');
            	console.log(data);
				for(var idx in data.resultList){
    				$("#couponUpdForm #typeDetail").append($("<option></option>")
    						.attr("value" , data.resultList[idx].code)
    						.text(data.resultList[idx].codeName));
				}
				$("#couponUpdForm #typeDetail").select2({width : 120});                   	
            }            
            
            var setUpdFormValidate = function (){
                $("#couponUpdForm").validate({
                    errorElement: 'span', //default input error message container
                    errorClass: 'help-block help-block-error', // default input error message class
                    rules: {
                    	name : {
                            required : true,
                        },
                        amount : {
                            required : true,
                        	number : true,
                        },
                    },
                    messages : {
                    	name : {
                            required : "상품명을 입력해주세요.",
                        },
                        amount : {
                            required : "권종을 선택해주세요.",
                        },
                    },
                    invalidHandler:function (form,validator){
                    	if(validator.numberOfInvalids()){
                    		kpcUtil.customAlert("필수항목이 입력되지 않았습니다.");
                    	}
                    },
                    errorPlacement : function (error , element){
                    	var icon = $(element).parent(".input-icon").children('i');
                    	icon.removeClass('fa-check').addClass("fa-warning");
                    	icon.attr("data-original-title" , error.text()).tooltip({"container" : "body"});
                    },
                    highlight: function (element) { // hightlight error inputs
                       	$(element).closest('.form-group').addClass('has-error'); // set error class to the control group
                    }, 
                    success : function (label,element){
                    	var icon = $(element).parent(".input-icon").children('i');
                    	$(element).closest(".form-group").removeClass("has-error").addClass("has-success");
                    	icon.removeClass('fa-warning').addClass("fa-check");
                    },
                });

            }                  
            
            var setUpdCommonCode = function (id){
      			kpcUtil.setSelectBoxData({
            		target : [
            			 "#expireDaysType"
            		], 
            		apiUrl : "/api/systemMng/common/commonCodeList",
            		params : {type : 'DATE'},
            		type   : "GET",
            		option : {width : 80},	
            		callBack : function (data,target,option){
            			for(var idx in data){
            				for(var idx2 in data[idx].resultList){
	            				$(target[idx]).append($("<option></option>")
	            						.attr("value" , data[idx].resultList[idx2].code)
	            						.text(data[idx].resultList[idx2].codeName));
            				}
            				$(target[idx]).select2(option);       
            			}
            			settypeUpdDetail(typeDetailAllData);       			
            			getBrochureData(id,"#couponUpdForm");
            		}
            	});            	
            }            
            
            return {
                init : function (){
                    setDatePicker();
                    setSelect2();
                    setCommonCode();
                }
            }
        }

        $(document).ready(function () {
        	approvalReuestDeleteModal("", "MENU-0003", "AWRK-0009"); //targetId를 초기화 시점에 알수 없을 경우 ""로 설정
            kcon().init();
        });
    </script>
{% endblock %}